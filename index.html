<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
</head>
<body>
    <input type="file" id="file" />
    <button id="export">Export</button>
    <div id="zip_size"></div>

    <script>
        var zip = new JSZip(), b64zip;

        $('#export').click(function(){
            files2zip64();
            saveAs(new Blob([b64zip]), "jszip64.txt");
            //saveAs('data:application/zip;base64,' + b64zip, 'export.zip');
        });

        function files2zip64(){
            var files = $('#file')[0].files;
            if(!files.length) return;

            if(files.length === 1 && (n=files[0].name).substring(n.lastIndexOf('.')+1).toLowerCase() === 'zip'){
                JSZip.loadAsync(files[0])
                .then(z=>{ zip = z; })
                .then(()=>{
                    zip.generateAsync({type: "base64", compression: "DEFLATE"}).then(function (b64) {
                        b64zip = b64;
                        document.getElementById('zip_size').innerHTML = (b64zip.length /1024/1024).toFixed(4) + 'mb';
                    });
                })
                .catch(err=>{ console.error(err); })
                .finally(()=>{  });
            } else {
                for (var i = 0; i < files.length; i++) {
                    var f = files[i];
                    zip.file(f.name, f);
                }

                zip.generateAsync({type: "base64", compression: "DEFLATE"}).then(function (b64) {
                    b64zip = b64;
                    document.getElementById('zip_size').innerHTML = (b64zip.length /1024/1024).toFixed(4) + 'mb';
                })
                .catch(err=>{ console.error(err); })
                .finally(()=>{  });
            }
        }

    </script>
</body>
</html>